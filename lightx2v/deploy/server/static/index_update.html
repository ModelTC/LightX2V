<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LightX2V 文生视频服务</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#9a72ff', // 主紫色
                        secondary: '#1b1240', // 深紫色背景
                        accent: '#b78bff', // 亮紫色强调
                        dark: '#0b0a20', // 深色背景
                        'dark-light': '#0f0e22', // 稍亮的深色
                        'laser-purple': '#9a72ff', // 激光紫色
                        'neon-purple': '#b78bff', // 霓虹紫色
                        'electric-purple': '#7c6aff', // 电光紫色
                    },
                    fontFamily: {
                        inter: ['Inter', 'sans-serif'],
                    },
                    boxShadow: {
                        'neon': '0 0 10px rgba(154, 114, 255, 0.5), 0 0 20px rgba(154, 114, 255, 0.3)',
                        'neon-lg': '0 0 15px rgba(154, 114, 255, 0.7), 0 0 30px rgba(154, 114, 255, 0.5)',
                        'laser': '0 0 20px rgba(154, 114, 255, 0.8), 0 0 40px rgba(154, 114, 255, 0.6), 0 0 60px rgba(154, 114, 255, 0.4), 0 0 80px rgba(154, 114, 255, 0.2)',
                        'laser-intense': '0 0 25px rgba(154, 114, 255, 0.9), 0 0 50px rgba(154, 114, 255, 0.7), 0 0 75px rgba(154, 114, 255, 0.5), 0 0 100px rgba(154, 114, 255, 0.3), 0 0 125px rgba(154, 114, 255, 0.1)',
                        'electric': '0 0 15px rgba(124, 106, 255, 0.8), 0 0 30px rgba(124, 106, 255, 0.6), 0 0 45px rgba(124, 106, 255, 0.4)'
                    }
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .text-gradient {
                background-clip: text;
                -webkit-background-clip: text;
                -webkit-text-fill-color: transparent;
            }
            .bg-grid {
                background-size: 40px 40px;
                background-image:
                    linear-gradient(to right, rgba(154, 114, 255, 0.15) 1px, transparent 1px),
                    linear-gradient(to bottom, rgba(154, 114, 255, 0.15) 1px, transparent 1px);
            }
            .scrollbar-thin {
                scrollbar-width: thin;
            }
            .scrollbar-thin::-webkit-scrollbar {
                width: 4px;
            }
            .scrollbar-thin::-webkit-scrollbar-thumb {
                background-color: rgba(154, 114, 255, 0.6);
                border-radius: 2px;
            }
            .animate-pulse-slow {
                animation: pulse 3s cubic-bezier(0.4, 0, 0.6, 0.5) infinite;
            }
            .animate-float {
                animation: float 6s ease-in-out infinite;
            }
            .animate-laser-glow {
                animation: laserGlow 2s ease-in-out infinite alternate;
            }
            .animate-electric-pulse {
                animation: electricPulse 1.5s ease-in-out infinite;
            }
            .animate-neon-flicker {
                animation: neonFlicker 3s ease-in-out infinite;
            }
            @keyframes float {
                0% { transform: translateY(0px); }
                50% { transform: translateY(-10px); }
                100% { transform: translateY(0px); }
            }
            @keyframes laserGlow {
                0% { 
                    box-shadow: 0 0 10px rgba(154, 114, 255, 0.8), 0 0 40px rgba(154, 114, 255, 0.6), 0 0 60px rgba(154, 114, 255, 0.4);
                    filter: brightness(0.8) saturate(0.7);
                }
                100% { 
                    box-shadow: 0 0 20px rgba(154, 114, 255, 1), 0 0 60px rgba(154, 114, 255, 0.8), 0 0 90px rgba(154, 114, 255, 0.6);
                    filter: brightness(1) saturate(1);
                }
            }
            @keyframes electricPulse {
                0%, 100% { 
                    box-shadow: 0 0 15px rgba(124, 106, 255, 0.8), 0 0 30px rgba(124, 106, 255, 0.6);
                    transform: scale(1);
                }
                50% { 
                    box-shadow: 0 0 25px rgba(124, 106, 255, 1), 0 0 50px rgba(124, 106, 255, 0.8), 0 0 75px rgba(124, 106, 255, 0.4);
                    transform: scale(1.02);
                }
            }
            @keyframes neonFlicker {
                0%, 100% { 
                    box-shadow: 0 0 20px rgba(183, 139, 255, 0.8), 0 0 40px rgba(183, 139, 255, 0.6);
                    opacity: 1;
                }
                25% { 
                    box-shadow: 0 0 15px rgba(183, 139, 255, 0.6), 0 0 30px rgba(183, 139, 255, 0.4);
                    opacity: 0.8;
                }
                75% { 
                    box-shadow: 0 0 25px rgba(183, 139, 255, 1), 0 0 50px rgba(183, 139, 255, 0.8);
                    opacity: 1.1;
                }
            }
            .bg-laser-gradient {
                background: linear-gradient(135deg, #9a72ff 0%, #b78bff 25%, #7c6aff 50%, #9a72ff 75%, #b78bff 100%);
                background-size: 200% 200%;
                animation: gradientShift 3s ease-in-out infinite;
            }
            @keyframes gradientShift {
                0%, 100% { background-position: 0% 50%; }
                50% { background-position: 100% 50%; }
            }
            .text-laser-glow {
                text-shadow: 0 0 10px rgba(154, 114, 255, 0.8), 0 0 20px rgba(154, 114, 255, 0.6), 0 0 30px rgba(154, 114, 255, 0.4);
            }
            .border-laser {
                border-color: #9a72ff;
                box-shadow: 0 0 15px rgba(154, 114, 255, 0.6), inset 0 0 15px rgba(154, 114, 255, 0.1);
            }
            .btn-primary{ 
                padding: 12px 22px; 
                border-radius: 14px; 
                font-weight: 700; 
                letter-spacing: 0.2px; 
                color: #0c0920;
                background: linear-gradient(135deg, #d2c1ff, #a88bff, #8e88ff); 
                border: 0; 
                text-decoration: none;
                box-shadow: 0 10px 30px rgba(140, 110, 255, 0.4); 
                transition: transform 0.15s ease, box-shadow 0.15s ease; 
            }
            .btn-primary:hover{ 
                transform: translateY(-1px); 
                box-shadow: 0 14px 40px rgba(140, 110, 255, 0.55); 
            }
            
            /* 修复布局问题 */
            .task-type-btn {
                padding: 0.75rem 1rem;
                font-size: 0.875rem;
                font-weight: 500;
                transition-property: color, background-color;
                transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
                transition-duration: 150ms;
            }
            
            .task-type-btn:hover {
                background-color: rgba(154, 114, 255, 0.1);
            }
            
            .model-selection {
                display: flex;
                flex-wrap: wrap;
                gap: 0.5rem;
            }
            
            .upload-section {
                display: grid;
                grid-template-columns: repeat(1, minmax(0, 1fr));
                gap: 1.5rem;
                margin-bottom: 1.5rem;
            }
            
            @media (min-width: 768px) {
                .upload-section {
                    grid-template-columns: repeat(2, minmax(0, 1fr));
                }
            }
            
            .upload-area {
                border: 2px dashed rgba(154, 114, 255, 0.4);
                border-radius: 0.75rem;
                padding: 1.5rem;
                text-align: center;
                transition-property: all;
                transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
                transition-duration: 150ms;
                cursor: pointer;
                background-color: rgba(27, 18, 64, 0.1);
            }
            
            .upload-area:hover {
                border-color: rgba(154, 114, 255, 0.7);
                box-shadow: 0 0 20px rgba(154, 114, 255, 0.8), 0 0 40px rgba(154, 114, 255, 0.6), 0 0 60px rgba(154, 114, 255, 0.4), 0 0 80px rgba(154, 114, 255, 0.2);
            }
            
            .upload-icon {
                margin: 0 auto;
                width: 4rem;
                height: 4rem;
                background-color: rgba(154, 114, 255, 0.2);
                border-radius: 9999px;
                display: flex;
                align-items: center;
                justify-content: center;
                margin-bottom: 1rem;
                transition-property: all;
                transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
                transition-duration: 150ms;
            }
            
            .upload-area:hover .upload-icon {
                background-color: rgba(154, 114, 255, 0.3);
            }
            
            .image-preview, .audio-preview {
                position: relative;
            }
            
            .btn-close {
                position: absolute;
                top: -0.5rem;
                right: -0.5rem;
                background-color: #ef4444;
                color: white;
                border-radius: 9999px;
                width: 1.5rem;
                height: 1.5rem;
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 0.75rem;
                cursor: pointer;
            }
            
            /* 确保flexbox布局正确 */
            #app {
                display: flex;
                height: 100vh;
                width: 100vw;
            }
            
            aside {
                flex-shrink: 0;
                width: 280px; /* 减小侧边栏宽度 */
                background-color: #1b1240;
                border-right: 1px solid rgba(154, 114, 255, 0.4);
                display: flex;
                flex-direction: column;
                transition-property: all;
                transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
                transition-duration: 300ms;
                z-index: 10;
            }
            
            main {
                flex: 1;
                display: flex;
                flex-direction: column;
                min-width: 0;
                width: calc(100vw - 280px); /* 主内容区域占据剩余宽度 */
            }
            
            /* 内容区域全屏显示 */
            .content-area {
                flex: 1;
                overflow-y: auto;
                background-color: #0b0a20;
                padding: 2rem;
                width: 100%;
            }
            
            /* 任务创建面板全屏 */
            #task-creator {
                max-width: none;
                width: 100%;
                padding: 0 1rem;
            }
            
            /* 任务详情面板全屏 */
            .task-detail-panel {
                max-width: none;
                width: 100%;
                padding: 0 1rem;
            }
            
            /* 上传区域全屏布局 */
            .upload-section {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
                gap: 2rem;
                margin-bottom: 2rem;
                width: 100%;
            }
            
            /* 任务类型选择全屏 */
            .task-type-selection {
                width: 100%;
                margin-bottom: 2rem;
            }
            
            .task-type-buttons {
                display: flex;
                width: 100%;
                border-bottom: 1px solid rgba(154, 114, 255, 0.3);
            }
            
            .task-type-btn {
                flex: 1;
                padding: 1rem 1.5rem;
                font-size: 1rem;
                font-weight: 500;
                transition-property: color, background-color;
                transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
                transition-duration: 150ms;
                text-align: center;
            }
            
            /* 模型选择全屏 */
            .model-selection {
                display: flex;
                flex-wrap: wrap;
                gap: 1rem;
                width: 100%;
                justify-content: flex-start;
            }
            
            /* 提示词输入全屏 */
            .prompt-input-section {
                width: 100%;
                margin-bottom: 2rem;
            }
            
            .prompt-textarea {
                width: 100%;
                min-height: 150px;
                resize: vertical;
            }
            
            /* 修复侧边栏切换 */
            aside.w-0 {
                width: 0;
                overflow: hidden;
            }
            
            aside.hidden {
                display: none;
            }
            
            /* 当侧边栏隐藏时，主内容区域全屏 */
            aside.w-0 + main,
            aside.hidden + main {
                width: 100vw;
            }
            
            /* 响应式设计 */
            @media (max-width: 1200px) {
                aside {
                    width: 250px;
                }
                
                main {
                    width: calc(100vw - 250px);
                }
            }
            
            @media (max-width: 768px) {
                aside {
                    width: 200px;
                }
                
                main {
                    width: calc(100vw - 200px);
                }
                
                .upload-section {
                    grid-template-columns: 1fr;
                }
            }
            
            /* 修复任务项样式 */
            .task-item {
                padding: 0.75rem;
                border-radius: 0.5rem;
                cursor: pointer;
                transition-property: all;
                transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
                transition-duration: 200ms;
            }
            
            .task-item:hover {
                background-color: rgba(154, 114, 255, 0.15);
                box-shadow: 0 0 20px rgba(154, 114, 255, 0.8), 0 0 40px rgba(154, 114, 255, 0.6), 0 0 60px rgba(154, 114, 255, 0.4), 0 0 80px rgba(154, 114, 255, 0.2);
            }
            
            /* 修复状态指示器 */
            .status-indicator {
                width: 0.75rem;
                height: 0.75rem;
                border-radius: 9999px;
                box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            }
            
            /* 修复按钮样式 */
            .btn-primary {
                padding: 12px 22px;
                border-radius: 14px;
                font-weight: 700;
                letter-spacing: 0.2px;
                color: #0c0920;
                background: linear-gradient(135deg, #d2c1ff, #a88bff, #8e88ff);
                border: 0;
                text-decoration: none;
                box-shadow: 0 10px 30px rgba(140, 110, 255, 0.4);
                transition: transform 0.15s ease, box-shadow 0.15s ease;
                cursor: pointer;
                display: inline-block;
            }
            
            .btn-primary:hover {
                transform: translateY(-1px);
                box-shadow: 0 14px 40px rgba(140, 110, 255, 0.55);
            }
            
            /* 修复模型按钮样式 */
            .model-btn {
                padding: 0.5rem 1rem;
                border-radius: 0.5rem;
                font-size: 0.875rem;
                transition-property: all;
                transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
                transition-duration: 150ms;
                cursor: pointer;
                border: 1px solid;
            }
            
            .model-btn.active {
                background-color: rgba(154, 114, 255, 0.2);
                border-color: rgba(154, 114, 255, 0.4);
                box-shadow: 0 0 20px rgba(154, 114, 255, 0.8), 0 0 40px rgba(154, 114, 255, 0.6), 0 0 60px rgba(154, 114, 255, 0.4), 0 0 80px rgba(154, 114, 255, 0.2);
                animation: electricPulse 1.5s ease-in-out infinite;
            }
            
            /* 确保内容区域正确滚动 */
            .content-scroll {
                flex: 1;
                overflow-y: auto;
            }
            
            /* 任务面板样式 */
            .task-running-panel,
            .task-failed-panel,
            .task-completed-panel {
                max-width: none;
                width: 100%;
                padding: 0 1rem;
            }
            
            /* 任务进行中面板样式 */
            .task-running-panel .animate-pulse-slow {
                animation: pulse 3s cubic-bezier(0.4, 0, 0.6, 0.5) infinite;
            }
            
            /* 任务失败面板样式 */
            .task-failed-panel .bg-red-500\/10 {
                background-color: rgba(239, 68, 68, 0.1);
            }
            
            /* 任务完成面板样式 */
            .task-completed-panel .aspect-video {
                aspect-ratio: 16 / 9;
            }
            
            .task-completed-panel video {
                width: 100%;
                height: 100%;
                object-fit: cover;
            }
            
            /* 素材预览样式 */
            .material-preview {
                display: flex;
                flex-wrap: wrap;
                gap: 0.75rem;
            }
            
            .material-preview img {
                border-radius: 0.5rem;
                transition: all 0.2s ease;
            }
            
            .material-preview img:hover {
                transform: scale(1.05);
                box-shadow: 0 0 20px rgba(154, 114, 255, 0.6);
            }
            
            /* 任务状态指示器增强 */
            .status-indicator {
                position: relative;
            }
            
            .status-indicator::after {
                content: '';
                position: absolute;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                width: 0.25rem;
                height: 0.25rem;
                background-color: currentColor;
                border-radius: 50%;
                opacity: 0.8;
            }
            
            /* 任务面板切换动画 */
            .task-panel-enter-active,
            .task-panel-leave-active {
                transition: all 0.3s ease;
            }
            
            .task-panel-enter-from {
                opacity: 0;
                transform: translateY(20px);
            }
            
            .task-panel-leave-to {
                opacity: 0;
                transform: translateY(-20px);
            }
            
            /* 响应式任务面板 */
            @media (max-width: 768px) {
                .task-running-panel,
                .task-failed-panel,
                .task-completed-panel {
                    padding: 0 0.5rem;
                }
                
                .task-completed-panel .aspect-video {
                    aspect-ratio: 4 / 3;
                }
            }
            
            /* 提示消息动画 */
            .animate-slide-down {
                animation: slideDown 0.3s ease-out;
            }
            
            @keyframes slideDown {
                0% {
                    opacity: 0;
                    transform: translate(-50%, -100%);
                }
                100% {
                    opacity: 1;
                    transform: translate(-50%, 0);
                }
            }
            
            /* 提示消息样式 */
            .alert {
                backdrop-filter: blur(10px);
                background: rgba(255, 255, 255, 0.95);
                border-radius: 0.75rem;
                box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            }
            
            .alert-success {
                border-left-color: #10b981;
                background: rgba(16, 185, 129, 0.1);
            }
            
            .alert-warning {
                border-left-color: #f59e0b;
                background: rgba(245, 158, 11, 0.1);
            }
            
            .alert-danger {
                border-left-color: #ef4444;
                background: rgba(239, 68, 68, 0.1);
            }
            
            .alert-info {
                border-left-color: #3b82f6;
                background: rgba(59, 130, 246, 0.1);
            }
        }
    </style>
</head>
<body class="bg-dark text-gray-100 font-inter min-h-screen flex overflow-hidden">
    <div id="app">
        <!-- 侧边栏 - 历史任务 -->
        <aside class="w-64 bg-secondary border-r border-laser-purple/40 flex flex-col transition-all duration-300 ease-in-out z-10">
            <div class="p-4 border-b border-laser-purple/40">
                <h1 class="text-xl font-bold flex items-center">
                    <i class="fas fa-video text-laser-purple mr-2"></i>
                    <span>LightX2V</span>
                </h1>
            </div>
            <div class="p-4 border-b border-laser-purple/40">
                <button 
                    @click="showTaskCreator" 
                    class="w-full btn-primary py-2 rounded-lg flex items-center justify-center transition-all duration-200 font-medium text-sm">
                    <i class="fas fa-plus mr-2"></i>
                    新建任务
                </button>
                <div class="relative mt-3">
                    <input
                        v-model="searchQuery"
                        class="w-full bg-dark-light border border-laser-purple/30 rounded-lg py-2 pl-10 pr-4 text-sm focus:outline-none focus:ring-2 focus:ring-laser-purple/50 transition-all focus:border-laser focus:shadow-laser"
                        placeholder="搜索历史任务..."
                        type="text"
                    />
                    <i class="fas fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                </div>
                
                <!-- 状态过滤 -->
                <div class="mt-3">
                    <div class="text-xs text-gray-400 mb-2">状态筛选</div>
                    <div class="flex flex-wrap gap-1">
                        <button 
                            @click="statusFilter = 'ALL'"
                            class="px-2 py-1 text-xs rounded transition-all"
                            :class="statusFilter === 'ALL' ? 'bg-laser-purple/30 text-laser-purple' : 'bg-dark-light text-gray-400 hover:bg-laser-purple/20'"
                        >
                            全部
                        </button>
                        <button 
                            @click="statusFilter = 'SUCCEED'"
                            class="px-2 py-1 text-xs rounded transition-all"
                            :class="statusFilter === 'SUCCEED' ? 'bg-green-500/30 text-green-400' : 'bg-dark-light text-gray-400 hover:bg-green-500/20'"
                        >
                            成功
                        </button>
                        <button 
                            @click="statusFilter = 'RUNNING'"
                            class="px-2 py-1 text-xs rounded transition-all"
                            :class="statusFilter === 'RUNNING' ? 'bg-yellow-500/30 text-yellow-400' : 'bg-dark-light text-gray-400 hover:bg-yellow-500/20'"
                        >
                            进行中
                        </button>
                        <button 
                            @click="statusFilter = 'FAILED'"
                            class="px-2 py-1 text-xs rounded transition-all"
                            :class="statusFilter === 'FAILED' ? 'bg-red-500/30 text-red-400' : 'bg-dark-light text-gray-400 hover:bg-red-500/20'"
                        >
                            失败
                        </button>
                    </div>
                </div>
            </div>
            <div class="flex-1 overflow-y-auto scrollbar-thin p-2">
                <div class="text-xs uppercase text-gray-400 font-semibold mb-2 px-3">
                    历史任务
                </div>
                <!-- 历史任务列表 -->
                <div class="space-y-1" id="history-tasks">
                    <div v-if="filteredTasks.length === 0" class="flex-col items-center justify-center py-12 text-center">
                        <div class="w-20 h-20 bg-laser-purple/20 rounded-full flex items-center justify-center mb-4 animate-float border border-laser-purple/30">
                            <i class="fas fa-clock text-laser-purple text-2xl"></i>
                        </div>
                        <p class="text-gray-400 text-sm">暂无历史任务</p>
                        <p class="text-gray-500 text-xs mt-1">开始创建你的第一个AI视频吧</p>
                    </div>
                    <!-- 任务项 -->
                    <div 
                        v-for="task in filteredTasks" 
                        :key="task.task_id" 
                        class="task-item p-3 rounded-lg cursor-pointer hover:bg-laser-purple/15 hover:shadow-laser transition-all duration-200"
                        :class="getTaskItemClass(task.status)"
                        @click="viewTaskDetail(task.task_id)"
                    >
                        <div class="flex items-start gap-3 mb-2">
                            <div class="w-16 h-12 bg-dark-light rounded overflow-hidden flex-shrink-0">
                                <img
                                    v-if="task.outputs && task.outputs.video"
                                    :src="getVideoThumbnail(task.outputs.video)"
                                    alt="视频预览"
                                    class="w-full h-full object-cover"
                                />
                                <div v-else class="w-full h-full bg-laser-purple/20 flex items-center justify-center">
                                    <i class="fas fa-video text-laser-purple"></i>
                                </div>
                            </div>
                            <div class="flex-1 min-w-0">
                                <div class="flex justify-between items-start mb-1">
                                    <h3 class="font-medium text-sm truncate">{{ task.params.prompt || '无标题任务' }}</h3>
                                    <div 
                                        :class="getStatusIndicatorClass(task.status)"
                                        :title="getTaskStatusDisplay(task.status)"
                                    ></div>
                                </div>
                                <p class="text-xs text-gray-400 mb-2 line-clamp-1">
                                    {{ getTaskTypeName(task.task_type) }} | {{ formatTime(task.create_t) }}
                                </p>
                                <div class="flex items-center justify-between text-xs">
                                    <span class="text-gray-500">{{ task.model_cls }}</span>
                                    <span :class="getTaskStatusColor(task.status)" class="font-medium">
                                        {{ getTaskStatusDisplay(task.status) }}
                                    </span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 任务进度条（仅显示进行中的任务） -->
                        <div v-if="task.status === 'RUNNING'" class="mt-2">
                            <div class="w-full bg-dark-light rounded-full h-1">
                                <div class="bg-laser-purple h-1 rounded-full transition-all duration-1000 ease-out"
                                     :style="{ width: getTaskProgress(task) + '%' }"></div>
                            </div>
                            <div class="text-xs text-gray-400 mt-1 text-center">
                                进度: {{ getTaskProgress(task) }}%
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </aside>

        <!-- 主内容区 -->
        <main class="flex-1 flex flex-col overflow-hidden">
            <!-- 顶部导航 -->
            <header class="h-16 bg-secondary/50 backdrop-blur-sm border-b border-laser-purple/30 flex items-center justify-between px-6">
                <div class="flex items-center">
                    <button 
                        @click="toggleSidebar" 
                        class="mr-4 text-gray-400 hover:text-laser-purple transition-colors hover:animate-laser-glow">
                        <i class="fas fa-bars"></i>
                    </button>
                </div>
                <div class="flex items-center space-x-4">
                    <div class="flex items-center">
                        <img
                            :src="currentUser.avatar_url"
                            alt="用户头像"
                            class="w-8 h-8 rounded-full object-cover border border-laser-purple/40"
                        />
                        <span class="ml-2 text-sm hidden md:inline">{{ currentUser.username }}</span>
                        <button @click="logout" class="ml-4 text-gray-400 hover:text-laser-purple transition-colors">
                            <i class="fas fa-sign-out-alt"></i>
                        </button>
                    </div>
                </div>
            </header>

            <!-- 内容区域 -->
            <div class="flex-1 overflow-y-auto bg-dark p-6 content-area">
                <!-- 任务创建面板 -->
                <div v-if="showCreator" class="max-w-4xl mx-auto" id="task-creator">
                    <!-- 任务类型选择 -->
                    <div class="mb-8 task-type-selection">
                        <div class="flex border-b border-laser-purple/30 task-type-buttons">
                            <button
                                v-for="taskType in availableTaskTypes"
                                :key="taskType"
                                @click="selectTask(taskType)"
                                class="task-type-btn"
                                :class="getTaskTypeBtnClass(taskType)"
                            >
                                <i :class="getTaskTypeIcon(taskType)" class="mr-2"></i>
                                {{ getTaskTypeName(taskType) }}
                            </button>
                        </div>
                    </div>

                    <!-- 模型选择 -->
                    <div v-if="selectedTaskId" class="mb-6">
                        <label class="block text-sm text-gray-400 mb-2">选择模型</label>
                        <div class="model-selection">
                            <button
                                v-for="model in availableModelClasses"
                                :key="model"
                                @click="selectModel(model)"
                                class="model-btn px-4 py-2 rounded-lg text-sm transition-all"
                                :class="getModelBtnClass(model)"
                            >
                                <i v-if="model === taskForm.model_cls" class="fas fa-star text-yellow-400 mr-1"></i>
                                {{ model }}
                            </button>
                        </div>
                    </div>

                    <!-- 上传区域 -->
                    <div v-if="selectedTaskId === 'i2v' || selectedTaskId === 'digital_human'" class="upload-section">
                        <!-- 上传图片 -->
                        <div v-if="selectedTaskId === 'i2v' || selectedTaskId === 'digital_human'" class="upload-area" @click="triggerImageUpload">
                            <div class="upload-icon">
                                <i class="fas fa-cloud-upload-alt text-laser-purple text-xl"></i>
                            </div>
                            <h3 class="font-medium mb-1">上传参考图片</h3>
                            <p class="text-xs text-gray-400 mb-4">支持JPG、PNG格式，大小不超过10MB</p>
                            <button class="text-xs btn-primary px-4 py-1.5 rounded-lg transition-all">选择图片</button>
                            <input 
                                type="file" 
                                ref="imageInput" 
                                @change="handleImageUpload" 
                                accept="image/*" 
                                style="display: none;">
                        </div>
                        
                        <!-- 上传音频 -->
                        <div v-if="selectedTaskId === 'digital_human'" class="upload-area" @click="triggerAudioUpload">
                            <div class="upload-icon">
                                <i class="fas fa-microphone text-laser-purple text-xl"></i>
                            </div>
                            <h3 class="font-medium mb-1">上传音频</h3>
                            <p class="text-xs text-gray-400 mb-4">支持MP3、WAV格式，最长支持120s</p>
                            <button class="text-xs btn-primary px-4 py-1.5 rounded-lg transition-all">上传音频</button>
                            <input 
                                type="file" 
                                ref="audioInput" 
                                @change="handleAudioUpload" 
                                accept="audio/*" 
                                style="display: none;">
                        </div>

                        <!-- 图片预览 -->
                        <div v-if="imagePreview" class="image-preview">
                            <img :src="imagePreview" alt="预览图片" class="w-full h-32 object-cover rounded-lg">
                            <button type="button" class="btn-close" @click="removeImage">×</button>
                        </div>

                        <!-- 音频预览 -->
                        <div v-if="audioPreview" class="audio-preview">
                            <audio controls class="w-full">
                                <source :src="audioPreview" type="audio/mpeg">
                            </audio>
                            <button type="button" class="btn-close" @click="removeAudio">×</button>
                        </div>
                    </div>

                    <!-- 提示词输入 -->
                    <div class="mb-6 prompt-input-section">
                        <div class="flex justify-between items-center mb-2">
                            <label class="block text-sm text-gray-400">提示词</label>
                            <div class="flex space-x-2">
                                <button @click="showPromptTemplates" class="text-xs text-gray-400 hover:text-laser-purple transition-colors hover:animate-laser-glow" title="提示词模板">
                                    <i class="fas fa-magic"></i>
                                </button>
                                <button @click="showPromptHistory" class="text-xs text-gray-400 hover:text-laser-purple transition-colors hover:animate-laser-glow" title="历史记录">
                                    <i class="fas fa-history"></i>
                                </button>
                            </div>
                        </div>
                        
                        <!-- 提示词模板选择 -->
                        <div v-if="showTemplates" class="mb-4 p-4 bg-secondary/30 rounded-lg">
                            <h4 class="text-sm font-medium mb-3 text-laser-purple">选择提示词模板</h4>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                                <button 
                                    v-for="template in getPromptTemplates(selectedTaskId)" 
                                    :key="template.id"
                                    @click="selectPromptTemplate(template)"
                                    class="p-3 text-left bg-dark-light rounded-lg hover:bg-laser-purple/20 transition-all border border-transparent hover:border-laser-purple/40"
                                >
                                    <div class="font-medium text-sm mb-1">{{ template.title }}</div>
                                    <div class="text-xs text-gray-400 line-clamp-2">{{ template.prompt }}</div>
                                </button>
                            </div>
                            <button @click="showTemplates = false" class="mt-3 text-xs text-gray-400 hover:text-laser-purple">
                                <i class="fas fa-times mr-1"></i>关闭模板
                            </button>
                        </div>
                        
                        <!-- 提示词历史记录 -->
                        <div v-if="showHistory" class="mb-4 p-4 bg-secondary/30 rounded-lg">
                            <div class="flex justify-between items-center mb-3">
                                <h4 class="text-sm font-medium text-laser-purple">提示词历史记录</h4>
                                <button @click="clearPromptHistory" class="text-xs text-red-400 hover:text-red-300 transition-colors" title="清空历史记录">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                            <div v-if="getPromptHistory().length === 0" class="text-center py-4 text-gray-400 text-sm">
                                暂无历史记录
                            </div>
                            <div v-else class="space-y-2 max-h-40 overflow-y-auto">
                                <button 
                                    v-for="(history, index) in getPromptHistory()" 
                                    :key="index"
                                    @click="selectPromptHistory(history)"
                                    class="w-full p-3 text-left bg-dark-light rounded-lg hover:bg-laser-purple/20 transition-all border border-transparent hover:border-laser-purple/40"
                                >
                                    <div class="text-sm text-gray-300 line-clamp-2">{{ history }}</div>
                                    <div class="text-xs text-gray-500 mt-1">点击使用此提示词</div>
                                </button>
                            </div>
                            <button @click="showHistory = false" class="mt-3 text-xs text-gray-400 hover:text-laser-purple">
                                <i class="fas fa-times mr-1"></i>关闭历史
                            </button>
                        </div>
                        
                        <div class="relative">
                            <textarea
                                v-model="taskForm.prompt"
                                class="w-full bg-dark-light border border-laser-purple/40 rounded-lg p-4 pr-16 text-sm min-h-[120px] focus:outline-none focus:ring-2 focus:ring-laser-purple/60 transition-all resize-none scrollbar-thin focus:border-laser focus:shadow-laser prompt-textarea"
                                :placeholder="getPromptPlaceholder()"
                                rows="3"
                                required
                            ></textarea>
                        </div>
                        
                        <!-- 高级配置选项 -->
                        <div class="mt-4 grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm text-gray-400 mb-2">种子值</label>
                                <input
                                    v-model="taskForm.seed"
                                    type="number"
                                    class="w-full bg-dark-light border border-laser-purple/40 rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-laser-purple/60 transition-all"
                                    placeholder="随机种子值"
                                />
                            </div>
                            <div>
                                <label class="block text-sm text-gray-400 mb-2">推理阶段</label>
                                <select
                                    v-model="taskForm.stage"
                                    class="w-full bg-dark-light border border-laser-purple/40 rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-laser-purple/60 transition-all"
                                >
                                    <option value="step_distill">蒸馏阶段</option>
                                    <option value="original">原始阶段</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="flex justify-between items-center mt-4">
                            <p class="text-xs text-gray-500">最多支持500个字符</p>
                            <div class="flex space-x-2">
                                <button @click="clearPrompt" class="text-xs btn-primary px-3 py-1 rounded transition-all">
                                    <i class="fas fa-sync-alt mr-1"></i>
                                    清空
                                </button>
                                <button @click="submitTask" :disabled="submitting" class="text-xs btn-primary px-4 py-1 rounded transition-all">
                                    <i class="fas fa-play mr-1"></i>
                                    {{ submitting ? '生成中...' : '生成视频' }}
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 任务详情显示面板 -->
                <div v-if="selectedTask && !showCreator" class="max-w-4xl mx-auto task-detail-panel">
                    <div class="mb-6">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-lg font-medium">{{ selectedTask.params.prompt || '任务详情' }}</h3>
                            <div class="flex space-x-3">
                                <button @click="shareTask(selectedTask)" class="text-sm btn-primary px-3 py-1.5 rounded-lg transition-all">
                                    <i class="fas fa-share-alt mr-1"></i>
                                    分享
                                </button>
                                <button @click="exportTaskInfo(selectedTask)" class="text-sm btn-primary px-3 py-1.5 rounded-lg transition-all">
                                    <i class="fas fa-download mr-1"></i>
                                    导出
                                </button>
                                <button @click="showTaskCreator" class="text-sm btn-primary px-3 py-1.5 rounded-lg transition-all">
                                    <i class="fas fa-plus mr-1"></i>
                                    新建任务
                                </button>
                            </div>
                        </div>

                        <!-- 任务状态显示 -->
                        <div class="bg-secondary/30 rounded-xl p-6 mb-6">
                            <h4 class="text-sm font-medium mb-3 flex items-center">
                                <i class="fas fa-info-circle text-laser-purple mr-2"></i>
                                任务信息
                            </h4>
                            <ul class="space-y-2 text-sm">
                                <li class="flex justify-between">
                                    <span class="text-gray-400">任务ID</span>
                                    <span>{{ selectedTask.task_id }}</span>
                                </li>
                                <li class="flex justify-between">
                                    <span class="text-gray-400">任务类型</span>
                                    <span>{{ selectedTask.task_type }}</span>
                                </li>
                                <li class="flex justify-between">
                                    <span class="text-gray-400">模型名称</span>
                                    <span class="text-laser-purple">{{ selectedTask.model_cls }}</span>
                                </li>
                                <li class="flex justify-between">
                                    <span class="text-gray-400">创建时间</span>
                                    <span>{{ formatTime(selectedTask.create_t) }}</span>
                                </li>
                                <li class="flex justify-between">
                                    <span class="text-gray-400">状态</span>
                                    <span :class="getStatusTextClass(selectedTask.status)">{{ selectedTask.status }}</span>
                                </li>
                            </ul>
                        </div>

                        <!-- 提示词 -->
                        <div class="bg-secondary/30 rounded-xl p-4 mb-6">
                            <h4 class="text-sm font-medium mb-3 flex items-center">
                                <i class="fas fa-file-alt text-laser-purple mr-2"></i>
                                提示词
                            </h4>
                            <div class="bg-dark-light rounded-lg p-4 text-sm text-gray-300">
                                <p>{{ selectedTask.params.prompt || '无提示词' }}</p>
                            </div>
                        </div>

                        <!-- 输出结果 -->
                        <div v-if="selectedTask.outputs && Object.keys(selectedTask.outputs).length > 0" class="bg-secondary/30 rounded-xl p-4 mb-6">
                            <h4 class="text-sm font-medium mb-3 flex items-center">
                                <i class="fas fa-video text-laser-purple mr-2"></i>
                                输出结果
                            </h4>
                            <div class="space-y-3">
                                <div v-for="(output, key) in selectedTask.outputs" :key="key" class="flex items-center justify-between bg-dark-light rounded-lg p-3">
                                    <div class="flex items-center">
                                        <i class="fas fa-file-video text-laser-purple mr-2"></i>
                                        <span class="text-sm">{{ key }}: {{ output }}</span>
                                    </div>
                                    <div class="flex space-x-2">
                                        <button @click="viewSingleResult(selectedTask.task_id, key, output)" class="text-xs btn-primary px-2 py-1 rounded">
                                            <i class="fas fa-eye mr-1"></i>查看
                                        </button>
                                        <button @click="downloadSingleResult(selectedTask.task_id, key, output)" class="text-xs btn-primary px-2 py-1 rounded">
                                            <i class="fas fa-download mr-1"></i>下载
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- 任务操作 -->
                        <div class="flex justify-center space-x-3">
                            <button v-if="['CREATED', 'PENDING', 'RUNNING'].includes(selectedTask.status)" 
                                    @click="cancelTask(selectedTask.task_id)" 
                                    class="px-4 py-2 btn-primary rounded-lg text-sm transition-all">
                                <i class="fas fa-times mr-2"></i>
                                取消任务
                            </button>
                            <button v-if="['SUCCEED', 'FAILED', 'CANCEL'].includes(selectedTask.status)" 
                                    @click="resumeTask(selectedTask.task_id)" 
                                    class="px-4 py-2 btn-primary rounded-lg text-sm transition-all">
                                <i class="fas fa-redo mr-2"></i>
                                重新生成
                            </button>
                        </div>
                    </div>
                </div>

                <!-- 任务进行中面板 -->
                <div v-if="selectedTask && selectedTask.status === 'RUNNING' && !showCreator" class="max-w-4xl mx-auto task-running-panel">
                    <div class="text-center py-12">
                        <div class="w-24 h-24 mx-auto bg-laser-purple/20 rounded-full flex items-center justify-center mb-6 animate-pulse-slow">
                            <i class="fas fa-spinner fa-spin text-laser-purple text-3xl"></i>
                        </div>
                        <h3 class="text-xl font-medium mb-2">视频生成中</h3>
                        <p class="text-gray-400 mb-6">AI正在努力生成您的视频，请稍候...</p>
                        
                        <!-- 进度条 -->
                        <div class="max-w-md mx-auto mb-6">
                            <div class="w-full bg-dark-light rounded-full h-2 mb-2">
                                <div class="bg-laser-purple h-2 rounded-full transition-all duration-1000 ease-out"
                                     :style="{ width: getTaskProgress(selectedTask) + '%' }"></div>
                            </div>
                            <div class="text-center text-sm text-gray-400">
                                进度: {{ getTaskProgress(selectedTask) }}%
                            </div>
                        </div>
                        
                        <!-- 任务信息 -->
                        <div class="bg-secondary/30 rounded-xl p-4 mt-6">
                            <h4 class="text-sm font-medium mb-3 flex items-center">
                                <i class="fas fa-info-circle text-laser-purple mr-2"></i>
                                任务参数
                            </h4>
                            <ul class="space-y-2 text-sm">
                                <li class="flex justify-between">
                                    <span class="text-gray-400">任务标题</span>
                                    <span>{{ selectedTask.params.prompt || '无标题任务' }}</span>
                                </li>
                                <li class="flex justify-between">
                                    <span class="text-gray-400">任务类型</span>
                                    <span>{{ getTaskTypeName(selectedTask.task_type) }}</span>
                                </li>
                                <li class="flex justify-between">
                                    <span class="text-gray-400">模型名称</span>
                                    <span class="text-laser-purple">{{ selectedTask.model_cls }}</span>
                                </li>
                                <li class="flex justify-between">
                                    <span class="text-gray-400">创建时间</span>
                                    <span>{{ formatTime(selectedTask.create_t) }}</span>
                                </li>
                            </ul>
                            
                            <!-- 提示词和素材预览 -->
                            <div class="mt-4 pt-4 border-t border-laser-purple/30">
                                <h4 class="text-sm font-medium mb-3 flex items-center">
                                    <i class="fas fa-file-alt text-laser-purple mr-2"></i>
                                    提示词
                                </h4>
                                <div class="bg-dark-light rounded-lg p-3 text-sm text-gray-300 mb-4">
                                    <p>{{ selectedTask.params.prompt || '无提示词' }}</p>
                                </div>
                                
                                <div v-if="selectedTask.input_image || selectedTask.input_audio" class="mt-4">
                                    <h4 class="text-sm font-medium mb-3 flex items-center">
                                        <i class="fas fa-image text-laser-purple mr-2"></i>
                                        素材预览
                                    </h4>
                                    <div class="flex flex-wrap gap-3">
                                        <div v-if="selectedTask.input_image" class="w-20 h-20 bg-dark-light rounded overflow-hidden">
                                            <img :src="getImagePreview(selectedTask.input_image)" alt="参考图片" class="w-full h-full object-cover">
                                        </div>
                                        <div v-if="selectedTask.input_audio" class="w-20 h-20 bg-dark-light rounded flex items-center justify-center">
                                            <i class="fas fa-music text-laser-purple text-xl"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mt-8 flex justify-center space-x-3">
                            <button @click="cancelTask(selectedTask.task_id)" class="px-4 py-2 btn-primary rounded-lg text-sm transition-all">
                                <i class="fas fa-times mr-2"></i>
                                取消任务
                            </button>
                        </div>
                    </div>
                </div>

                <!-- 任务失败面板 -->
                <div v-if="selectedTask && selectedTask.status === 'FAILED' && !showCreator" class="max-w-4xl mx-auto task-failed-panel">
                    <div class="text-center py-12">
                        <div class="w-24 h-24 mx-auto bg-red-500/10 rounded-full flex items-center justify-center mb-6">
                            <i class="fas fa-exclamation-triangle text-red-500 text-3xl"></i>
                        </div>
                        <h3 class="text-xl font-medium mb-2">视频生成失败</h3>
                        <p class="text-gray-400 mb-4 max-w-md mx-auto">
                            很抱歉，您的视频生成任务未能完成。这可能是由于资源限制或参数设置问题导致的。
                        </p>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                            <div class="bg-secondary/30 rounded-xl p-4">
                                <h4 class="text-sm font-medium mb-3 flex items-center">
                                    <i class="fas fa-info-circle text-laser-purple mr-2"></i>
                                    任务参数
                                </h4>
                                <ul class="space-y-2 text-sm">
                                    <li class="flex justify-between">
                                        <span class="text-gray-400">任务标题</span>
                                        <span>{{ selectedTask.params.prompt || '无标题任务' }}</span>
                                    </li>
                                    <li class="flex justify-between">
                                        <span class="text-gray-400">任务类型</span>
                                        <span>{{ getTaskTypeName(selectedTask.task_type) }}</span>
                                    </li>
                                    <li class="flex justify-between">
                                        <span class="text-gray-400">模型名称</span>
                                        <span>{{ selectedTask.model_cls }}</span>
                                    </li>
                                    <li class="flex justify-between">
                                        <span class="text-gray-400">创建时间</span>
                                        <span>{{ formatTime(selectedTask.create_t) }}</span>
                                    </li>
                                </ul>
                            </div>
                            <div class="bg-secondary/30 rounded-lg p-4 text-left">
                                <h4 class="text-sm font-medium mb-2 text-red-400">错误信息:</h4>
                                <p class="text-sm text-gray-300">
                                    {{ selectedTask.error_message || '任务执行过程中发生未知错误，请检查参数设置或联系技术支持。' }}
                                </p>
                            </div>
                        </div>
                        
                        <!-- 解决建议 -->
                        <div class="bg-secondary/30 rounded-lg p-4 mb-6">
                            <h4 class="text-sm font-medium mb-3 flex items-center">
                                <i class="fas fa-lightbulb text-yellow-400 mr-2"></i>
                                解决建议
                            </h4>
                            <ul class="text-sm text-gray-300 space-y-2">
                                <li class="flex items-start">
                                    <i class="fas fa-check text-green-400 mr-2 mt-1 text-xs"></i>
                                    检查提示词是否清晰明确，避免过于复杂或模糊的描述
                                </li>
                                <li class="flex items-start">
                                    <i class="fas fa-check text-green-400 mr-2 mt-1 text-xs"></i>
                                    确认上传的图片或音频文件格式正确，大小在限制范围内
                                </li>
                                <li class="flex items-start">
                                    <i class="fas fa-check text-green-400 mr-2 mt-1 text-xs"></i>
                                    尝试使用不同的模型或参数设置重新生成
                                </li>
                                <li class="flex items-start">
                                    <i class="fas fa-check text-green-400 mr-2 mt-1 text-xs"></i>
                                    如果问题持续存在，请联系技术支持获取帮助
                                </li>
                            </ul>
                        </div>
                        
                        <!-- 提示词和素材预览 -->
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                            <div class="bg-secondary/30 rounded-xl p-4">
                                <h4 class="text-sm font-medium mb-3 flex items-center">
                                    <i class="fas fa-file-alt text-laser-purple mr-2"></i>
                                    提示词
                                </h4>
                                <div class="bg-dark-light rounded-lg p-3 text-sm text-gray-300">
                                    <p>{{ selectedTask.params.prompt || '无提示词' }}</p>
                                </div>
                            </div>
                            <div v-if="selectedTask.input_image || selectedTask.input_audio" class="bg-secondary/30 rounded-xl p-4">
                                <h4 class="text-sm font-medium mb-3 flex items-center">
                                    <i class="fas fa-image text-laser-purple mr-2"></i>
                                    素材预览
                                </h4>
                                <div class="flex flex-wrap gap-3">
                                    <div v-if="selectedTask.input_image" class="w-20 h-20 bg-dark-light rounded overflow-hidden">
                                        <img :src="getImagePreview(selectedTask.input_image)" alt="参考图片" class="w-full h-full object-cover">
                                    </div>
                                    <div v-if="selectedTask.input_audio" class="w-20 h-20 bg-dark-light rounded flex items-center justify-center">
                                        <i class="fas fa-music text-laser-purple text-xl"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mt-8 flex justify-center space-x-3">
                            <button @click="resumeTask(selectedTask.task_id)" class="px-4 py-2 btn-primary rounded-lg text-sm transition-all">
                                <i class="fas fa-redo mr-2"></i>
                                重新生成
                            </button>
                        </div>
                    </div>
                </div>

                <!-- 任务完成面板 - 视频预览 -->
                <div v-if="selectedTask && selectedTask.status === 'SUCCEED' && !showCreator" class="max-w-4xl mx-auto task-completed-panel">
                    <div class="mb-6">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-lg font-medium">{{ selectedTask.params.prompt || '任务详情' }}</h3>
                            <div class="flex space-x-3">
                                <button @click="shareTask(selectedTask)" class="text-sm btn-primary px-3 py-1.5 rounded-lg transition-all">
                                    <i class="fas fa-share-alt mr-1"></i>
                                    分享
                                </button>
                                <button @click="exportTaskInfo(selectedTask)" class="text-sm btn-primary px-3 py-1.5 rounded-lg transition-all">
                                    <i class="fas fa-download mr-1"></i>
                                    导出
                                </button>
                                <button @click="showTaskCreator" class="text-sm btn-primary px-3 py-1.5 rounded-lg transition-all">
                                    <i class="fas fa-plus mr-1"></i>
                                    新建任务
                                </button>
                            </div>
                        </div>
                        
                        <!-- 视频预览 -->
                        <div v-if="selectedTask.outputs && selectedTask.outputs.video" class="relative rounded-xl overflow-hidden bg-black border border-laser-purple/50 aspect-video mb-6 group">
                            <!-- 视频播放器 -->
                            <video 
                                class="w-full h-full object-cover" 
                                controls 
                                preload="metadata"
                                :src="getVideoUrl(selectedTask.task_id, 'video')"
                            >
                                您的浏览器不支持视频播放。
                            </video>
                            
                            <!-- 重新生成按钮 -->
                            <button class="absolute top-4 right-4 text-sm btn-primary px-3 py-1.5 rounded-lg transition-all">
                                <i class="fas fa-redo mr-1"></i>
                                重新生成
                            </button>
                        </div>
                        
                        <!-- 任务参数 -->
                        <div class="bg-secondary/30 rounded-xl p-4 mb-6">
                            <h4 class="text-sm font-medium mb-3 flex items-center">
                                <i class="fas fa-info-circle text-laser-purple mr-2"></i>
                                任务参数
                            </h4>
                            <ul class="space-y-2 text-sm">
                                <li class="flex justify-between">
                                    <span class="text-gray-400">任务标题</span>
                                    <span>{{ selectedTask.params.prompt || '无标题任务' }}</span>
                                </li>
                                <li class="flex justify-between">
                                    <span class="text-gray-400">任务类型</span>
                                    <span>{{ getTaskTypeName(selectedTask.task_type) }}</span>
                                </li>
                                <li class="flex justify-between">
                                    <span class="text-gray-400">模型名称</span>
                                    <span class="text-laser-purple">{{ selectedTask.model_cls }}</span>
                                </li>
                                <li class="flex justify-between">
                                    <span class="text-gray-400">创建时间</span>
                                    <span>{{ formatTime(selectedTask.create_t) }}</span>
                                </li>
                                <li class="flex justify-between">
                                    <span class="text-gray-400">完成时间</span>
                                    <span>{{ formatTime(selectedTask.finish_t) }}</span>
                                </li>
                            </ul>
                        </div>
                        
                        <!-- 原始提示词 -->
                        <div class="bg-secondary/30 rounded-xl p-4 mb-6">
                            <h4 class="text-sm font-medium mb-3 flex items-center">
                                <i class="fas fa-file-alt text-laser-purple mr-2"></i>
                                原始提示词
                            </h4>
                            <div class="bg-dark-light rounded-lg p-4 text-sm text-gray-300">
                                <p>{{ selectedTask.params.prompt || '无提示词' }}</p>
                            </div>
                        </div>
                        
                        <!-- 素材预览 -->
                        <div v-if="selectedTask.input_image || selectedTask.input_audio" class="mb-6">
                            <h4 class="text-sm font-medium mb-3 flex items-center">
                                <i class="fas fa-image text-laser-purple mr-2"></i>
                                素材预览
                            </h4>
                            <div class="flex flex-wrap gap-3">
                                <div v-if="selectedTask.input_image" class="w-32 h-32 bg-dark-light rounded overflow-hidden">
                                    <img :src="getImagePreview(selectedTask.input_image)" alt="参考图片" class="w-full h-full object-cover">
                                </div>
                                <div v-if="selectedTask.input_audio" class="w-32 h-32 bg-dark-light rounded flex items-center justify-center">
                                    <i class="fas fa-music text-laser-purple text-3xl"></i>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 任务标签 -->
                        <div class="mb-6">
                            <h4 class="text-sm font-medium mb-3 flex items-center">
                                <i class="fas fa-tags text-laser-purple mr-2"></i>
                                任务标签
                            </h4>
                            <div class="flex flex-wrap gap-2">
                                <span v-for="tag in getTaskTags(selectedTask)" 
                                      :key="tag" 
                                      class="px-3 py-1 bg-laser-purple/20 text-laser-purple text-xs rounded-full border border-laser-purple/30">
                                    {{ tag }}
                                </span>
                            </div>
                        </div>
                        
                        <!-- 视频统计信息 -->
                        <div class="mb-6" v-if="selectedTask.outputs && selectedTask.outputs.video">
                            <h4 class="text-sm font-medium mb-3 flex items-center">
                                <i class="fas fa-chart-bar text-laser-purple mr-2"></i>
                                视频统计
                            </h4>
                            <div class="grid grid-cols-3 gap-4">
                                <div class="bg-dark-light rounded-lg p-3 text-center">
                                    <div class="text-lg font-bold text-laser-purple">{{ getVideoDuration(selectedTask.outputs.video) || '未知' }}</div>
                                    <div class="text-xs text-gray-400">时长</div>
                                </div>
                                <div class="bg-dark-light rounded-lg p-3 text-center">
                                    <div class="text-lg font-bold text-laser-purple">{{ getVideoResolution(selectedTask.outputs.video) || '720p' }}</div>
                                    <div class="text-xs text-gray-400">分辨率</div>
                                </div>
                                <div class="bg-dark-light rounded-lg p-3 text-center">
                                    <div class="text-lg font-bold text-laser-purple">{{ getVideoFileSize(selectedTask.outputs.video) || '未知' }}</div>
                                    <div class="text-xs text-gray-400">文件大小</div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 任务操作 -->
                        <div class="flex justify-center space-x-3">
                            <button v-if="selectedTask.outputs && selectedTask.outputs.video" 
                                    @click="downloadSingleResult(selectedTask.task_id, 'video', selectedTask.outputs.video)" 
                                    class="px-4 py-2 btn-primary rounded-lg text-sm transition-all">
                                <i class="fas fa-download mr-2"></i>
                                下载视频
                            </button>
                            <button @click="resumeTask(selectedTask.task_id)" class="px-4 py-2 btn-primary rounded-lg text-sm transition-all">
                                <i class="fas fa-redo mr-2"></i>
                                重新生成
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- 加载指示器 -->
        <div v-if="loading" class="loading position-fixed top-50 start-50 translate-middle show">
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">加载中...</span>
            </div>
        </div>

        <!-- 提示消息 -->
        <div v-if="alert.show" class="position-fixed top-0 start-50 translate-middle-x mt-3" style="z-index: 9999;">
            <div :class="`alert alert-${alert.type} alert-dismissible fade show`" role="alert">
                {{ alert.message }}
                <button type="button" class="btn-close" @click="alert.show = false"></button>
            </div>
        </div>

        <!-- 增强的提示消息系统 -->
        <div v-if="alert.show" 
             class="fixed top-4 left-1/2 transform -translate-x-1/2 z-50 max-w-md w-full px-4"
             :class="getAlertClass(alert.type)">
            <div class="flex items-center p-4 rounded-lg shadow-lg border-l-4 transition-all duration-300 ease-out"
                 :class="getAlertBorderClass(alert.type)">
                <div class="flex-shrink-0 mr-3">
                    <i :class="getAlertIcon(alert.type)" class="text-xl"></i>
                </div>
                <div class="flex-1">
                    <p class="text-sm font-medium" :class="getAlertTextClass(alert.type)">
                        {{ alert.message }}
                    </p>
                </div>
                <div class="flex-shrink-0 ml-3">
                    <button @click="alert.show = false" 
                            class="text-gray-400 hover:text-gray-600 transition-colors">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>

    <script>
        const { createApp, ref, computed, onMounted, watch } = Vue;

        createApp({
            setup() {
                // 响应式数据
                const isLoggedIn = ref(true);
                const loading = ref(false);
                const submitting = ref(false);
                const showCreator = ref(true);
                const searchQuery = ref('');
                const currentUser = ref({
                    username: "测试用户",
                    avatar_url: "https://via.placeholder.com/32x32",
                    user_id: "test_user_001"
                });
                const models = ref([
                    {
                        task: "t2v",
                        model_cls: "Wan2.1",
                        stage: "step_distill"
                    },
                    {
                        task: "i2v",
                        model_cls: "Wan2.1",
                        stage: "step_distill"
                    },
                    {
                        task: "t2v",
                        model_cls: "Wan2.2",
                        stage: "original"
                    },
                    {
                        task: "digital_human",
                        model_cls: "Wan2.1-DigitalHuman",
                        stage: "step_distill"
                    }
                ]);
                const tasks = ref([
                    {
                        task_id: "test-001",
                        task_type: "t2v",
                        model_cls: "Wan2.1",
                        stage: "step_distill",
                        status: "SUCCEED",
                        params: {
                            prompt: "一只可爱的小猫在花园里玩耍",
                            seed: 42
                        },
                        create_t: "1704067200",
                        outputs: {
                            video: "test_video.mp4"
                        }
                    },
                    {
                        task_id: "test-002",
                        task_type: "i2v",
                        model_cls: "Wan2.1",
                        stage: "step_distill",
                        status: "RUNNING",
                        params: {
                            prompt: "城市夜景",
                            seed: 123
                        },
                        create_t: "1704070800",
                        outputs: {}
                    }
                ]);
                const alert = ref({ show: false, message: '', type: 'info' });
                const selectedTaskId = ref(null);
                const selectedTask = ref(null);
                const statusFilter = ref('ALL');
                const pagination = ref(null);
                const currentPage = ref(1);
                const pageSize = ref(10);

                const taskForm = ref({
                    task: '',
                    model_cls: '',
                    stage: 'step_distill',
                    imageFile: null,
                    audioFile: null,
                    prompt: '',
                    seed: 42
                });

                const imagePreview = ref(null);
                const audioPreview = ref(null);

                // 提示词模板相关
                const showTemplates = ref(false);
                const showHistory = ref(false);

                // 计算属性
                const availableTaskTypes = computed(() => {
                    return [...new Set(models.value.map(m => m.task))];
                });

                const availableModelClasses = computed(() => {
                    if (!taskForm.value.task) return [];
                    return [...new Set(models.value
                        .filter(m => m.task === taskForm.value.task)
                        .map(m => m.model_cls))];
                });

                const filteredTasks = computed(() => {
                    let filtered = tasks.value;
                    
                    // 状态过滤
                    if (statusFilter.value !== 'ALL') {
                        filtered = filtered.filter(task => task.status === statusFilter.value);
                    }
                    
                    // 搜索过滤
                    if (searchQuery.value) {
                        filtered = filtered.filter(task => 
                            task.params.prompt?.toLowerCase().includes(searchQuery.value.toLowerCase()) ||
                            task.task_id.toLowerCase().includes(searchQuery.value.toLowerCase()) ||
                            task.task_type.toLowerCase().includes(searchQuery.value.toLowerCase())
                        );
                    }
                    
                    return filtered;
                });

                // 方法
                const showAlert = (message, type = 'info') => {
                    alert.value = { show: true, message, type };
                    
                    // 自动隐藏时间根据类型调整
                    const hideTime = type === 'danger' ? 8000 : 5000;
                    setTimeout(() => {
                        alert.value.show = false;
                    }, hideTime);
                };

                const setLoading = (value) => {
                    loading.value = value;
                };

                const apiCall = async (endpoint, options = {}) => {
                    const url = `${endpoint}`;
                    const headers = {
                        'Content-Type': 'application/json',
                        ...options.headers
                    };

                    if (localStorage.getItem('accessToken')) {
                        headers['Authorization'] = `Bearer ${localStorage.getItem('accessToken')}`;
                    }

                    const response = await fetch(url, {
                        ...options,
                        headers
                    });

                    if (response.status === 401) {
                        logout();
                        throw new Error('认证失败，请重新登录');
                    }
                    if (response.status === 400) {
                        const error = await response.json();
                        showAlert(error.message, 'danger');
                        throw new Error(error.message);
                    }

                    await new Promise(resolve => setTimeout(resolve, 50));
                    return response;
                };

                const logout = () => {
                    localStorage.removeItem('accessToken');
                    localStorage.removeItem('currentUser');
                    currentUser.value = {};
                    isLoggedIn.value = false;
                    models.value = [];
                    tasks.value = [];
                };

                const loadModels = async () => {
                    try {
                        const response = await apiCall('./api/v1/model/list');
                        if (response.ok) {
                            const data = await response.json();
                            models.value = data.models || [];
                        } else {
                            showAlert('加载模型列表失败', 'danger');
                        }
                    } catch (error) {
                        showAlert(`加载模型失败: ${error.message}`, 'danger');
                    }
                };

                const handleImageUpload = (event) => {
                    const file = event.target.files[0];
                    taskForm.value.imageFile = file;
                    
                    if (file) {
                        const reader = new FileReader();
                        reader.onload = (e) => {
                            imagePreview.value = e.target.result;
                        };
                        reader.readAsDataURL(file);
                    } else {
                        imagePreview.value = null;
                    }
                };

                const selectTask = (taskType) => {
                    selectedTaskId.value = taskType;
                    taskForm.value.task = taskType;
                    taskForm.value.model_cls = '';
                    taskForm.value.prompt = '';
                    imagePreview.value = null;
                    audioPreview.value = null;
                    taskForm.value.imageFile = null;
                    taskForm.value.audioFile = null;
                };

                const selectModel = (model) => {
                    taskForm.value.model_cls = model;
                };

                const triggerImageUpload = () => {
                    document.querySelector('input[type="file"][accept="image/*"]').click();
                };

                const triggerAudioUpload = () => {
                    document.querySelector('input[type="file"][accept="audio/*"]').click();
                };

                const removeImage = () => {
                    imagePreview.value = null;
                    taskForm.value.imageFile = null;
                };

                const removeAudio = () => {
                    audioPreview.value = null;
                    taskForm.value.audioFile = null;
                };

                const handleAudioUpload = (event) => {
                    const file = event.target.files[0];
                    taskForm.value.audioFile = file;
                    
                    if (file) {
                        const reader = new FileReader();
                        reader.onload = (e) => {
                            audioPreview.value = e.target.result;
                        };
                        reader.readAsDataURL(file);
                    } else {
                        audioPreview.value = null;
                    }
                };

                const submitTask = async () => {
                    try {
                        // 表单验证
                        if (!taskForm.value.task) {
                            showAlert('请选择任务类型', 'warning');
                            return;
                        }
                        
                        if (!taskForm.value.model_cls) {
                            showAlert('请选择模型', 'warning');
                            return;
                        }
                        
                        if (!taskForm.value.prompt || taskForm.value.prompt.trim().length === 0) {
                            showAlert('请输入提示词', 'warning');
                            return;
                        }
                        
                        if (taskForm.value.prompt.length > 500) {
                            showAlert('提示词长度不能超过500个字符', 'warning');
                            return;
                        }
                        
                        if (taskForm.value.task === 'i2v' && !taskForm.value.imageFile) {
                            showAlert('图生视频任务需要上传参考图片', 'warning');
                            return;
                        }
                        
                        if (taskForm.value.task === 'digital_human' && !taskForm.value.imageFile) {
                            showAlert('数字人任务需要上传参考图片', 'warning');
                            return;
                        }
                        
                        if (taskForm.value.task === 'digital_human' && !taskForm.value.audioFile) {
                            showAlert('数字人任务需要上传音频文件', 'warning');
                            return;
                        }
                        
                        setLoading(true);
                        submitting.value = true;
                        
                        var formData = {
                            task: taskForm.value.task,
                            model_cls: taskForm.value.model_cls,
                            stage: taskForm.value.stage,
                            prompt: taskForm.value.prompt.trim(),
                            seed: taskForm.value.seed || Math.floor(Math.random() * 1000000)
                        };
                        
                        if (taskForm.value.model_cls.startsWith('wan2.1')) {
                            formData.negative_prompt = "镜头晃动，色调艳丽，过曝，静态，细节模糊不清，字幕，风格，作品，画作，画面，静止，整体发灰，最差质量，低质量，JPEG压缩残留，丑陋的，残缺的，多余的手指，画得不好的手部，画得不好的脸部，畸形的，毁容的，形态畸形的肢体，手指融合，静止不动的画面，杂乱的背景，三条腿，背景人很多，倒着走"
                        }

                        if (taskForm.value.task === 'i2v' && taskForm.value.imageFile) {
                            const base64 = await fileToBase64(taskForm.value.imageFile);
                            formData.input_image = {
                                type: 'base64',
                                data: base64
                            };
                        }

                        if (taskForm.value.task === 'digital_human') {
                            if (taskForm.value.imageFile) {
                                const base64 = await fileToBase64(taskForm.value.imageFile);
                                formData.input_image = {
                                    type: 'base64',
                                    data: base64
                                };
                            }
                            if (taskForm.value.audioFile) {
                                const base64 = await fileToBase64(taskForm.value.audioFile);
                                formData.input_audio = {
                                    type: 'base64',
                                    data: base64
                                };
                            }
                        }

                        const response = await apiCall('./api/v1/task/submit', {
                            method: 'POST',
                            body: JSON.stringify(formData)
                        });

                        if (response.ok) {
                            const result = await response.json();
                            showAlert(`任务提交成功！任务ID: ${result.task_id}`, 'success');
                            
                            // 保存提示词到历史记录
                            addPromptToHistory(taskForm.value.prompt);
                            
                            await refreshTasks();
                            selectedTaskId.value = null;
                            showCreator.value = true;
                            
                            // 重置表单
                            taskForm.value = {
                                task: '',
                                model_cls: '',
                                stage: 'step_distill',
                                imageFile: null,
                                audioFile: null,
                                prompt: '',
                                seed: Math.floor(Math.random() * 1000000)
                            };
                            imagePreview.value = null;
                            audioPreview.value = null;
                        } else {
                            const error = await response.json();
                            showAlert(`任务提交失败: ${error.message}`, 'danger');
                        }
                    } catch (error) {
                        showAlert(`提交任务失败: ${error.message}`, 'danger');
                    } finally {
                        submitting.value = false;
                        setLoading(false);
                    }
                };

                const fileToBase64 = (file) => {
                    return new Promise((resolve, reject) => {
                        const reader = new FileReader();
                        reader.readAsDataURL(file);
                        reader.onload = () => {
                            const base64 = reader.result.split(',')[1];
                            resolve(base64);
                        };
                        reader.onerror = error => reject(error);
                    });
                };

                const formatTime = (timestamp) => {
                    if (!timestamp) return '';
                    const date = new Date(timestamp * 1000);
                    return date.toLocaleString('zh-CN');
                };

                const refreshTasks = async () => {
                    try {
                        const params = new URLSearchParams({
                            page: currentPage.value.toString(),
                            page_size: pageSize.value.toString()
                        });

                        if (statusFilter.value !== 'ALL') {
                            params.append('status', statusFilter.value);
                        }

                        const response = await apiCall(`./api/v1/task/list?${params.toString()}`);
                        if (response.ok) {
                            const data = await response.json();
                            tasks.value = data.tasks || [];
                            pagination.value = data.pagination || null;
                        } else {
                            showAlert('刷新任务列表失败', 'danger');
                        }
                    } catch (error) {
                        showAlert(`刷新任务列表失败: ${error.message}`, 'danger');
                    }
                };

                const getStatusBadgeClass = (status) => {
                    const statusMap = {
                        'SUCCEED': 'bg-success',
                        'FAILED': 'bg-danger',
                        'RUNNING': 'bg-warning',
                        'PENDING': 'bg-secondary',
                        'CREATED': 'bg-secondary'
                    };
                    return statusMap[status] || 'bg-secondary';
                };

                const downloadSingleResult = async (taskId, key, outputPath) => {
                    try {
                        setLoading(true);
                        const response = await apiCall(`./api/v1/task/result?task_id=${taskId}&name=${key}`);
                        if (response.ok) {
                            const blob = await response.blob();
                            const url = window.URL.createObjectURL(blob);
                            const a = document.createElement('a');
                            a.href = url;
                            a.download = `${outputPath}`;
                            document.body.appendChild(a);
                            a.click();
                            document.body.removeChild(a);
                            window.URL.revokeObjectURL(url);
                        } else {
                            showAlert('获取结果失败', 'danger');
                        }
                    } catch (error) {
                        showAlert(`下载结果失败: ${error.message}`, 'danger');
                    } finally {
                        setLoading(false);
                    }
                };

                const viewSingleResult = async (taskId, key, outputPath) => {
                    try {
                        setLoading(true);
                        const response = await apiCall(`./api/v1/task/result?task_id=${taskId}&name=${key}`);
                        if (response.ok) {
                            const blob = await response.blob();
                            const videoBlob = new Blob([blob], { type: 'video/mp4' });
                            const url = window.URL.createObjectURL(videoBlob);
                            window.open(url, '_blank');
                        } else {
                            showAlert('获取结果失败', 'danger');
                        }
                    } catch (error) {
                        showAlert(`查看结果失败: ${error.message}`, 'danger');
                    } finally {
                        setLoading(false);
                    }
                };

                const cancelTask = async (taskId) => {
                    try {
                        const response = await apiCall(`./api/v1/task/cancel?task_id=${taskId}`);
                        if (response.ok) {
                            showAlert('任务取消成功', 'success');
                            await refreshTasks();
                        } else {
                            const error = await response.json();
                            showAlert(`取消任务失败: ${error.message}`, 'danger');
                        }
                    } catch (error) {
                        showAlert(`取消任务失败: ${error.message}`, 'danger');
                    }
                };

                const resumeTask = async (taskId) => {
                    try {
                        const response = await apiCall(`./api/v1/task/resume?task_id=${taskId}`);
                        if (response.ok) {
                            showAlert('任务重试成功', 'success');
                            await refreshTasks();
                        } else {
                            const error = await response.json();
                            showAlert(`重试任务失败: ${error.message}`, 'danger');
                        }
                    } catch (error) {
                        showAlert(`重试任务失败: ${error.message}`, 'danger');
                    }
                };

                const viewTaskDetail = async (taskId) => {
                    try {
                        setLoading(true);
                        const response = await apiCall(`./api/v1/task/detail?task_id=${taskId}`);
                        if (response.ok) {
                            const data = await response.json();
                            selectedTask.value = data;
                            selectedTaskId.value = data.task_type;
                            showCreator.value = false;
                        } else {
                            showAlert('获取任务详情失败', 'danger');
                        }
                    } catch (error) {
                        showAlert(`查看任务详情失败: ${error.message}`, 'danger');
                    } finally {
                        setLoading(false);
                    }
                };

                const showTaskCreator = () => {
                    showCreator.value = true;
                    selectedTask.value = null;
                    selectedTaskId.value = null;
                };

                const toggleSidebar = () => {
                    const sidebar = document.querySelector('aside');
                    sidebar.classList.toggle('w-64');
                    sidebar.classList.toggle('w-0');
                    sidebar.classList.toggle('hidden');
                };

                const clearPrompt = () => {
                    taskForm.value.prompt = '';
                };

                const getTaskItemClass = (status) => {
                    if (status === 'SUCCEED') return 'bg-laser-purple/15 border border-laser-purple/30';
                    if (status === 'RUNNING') return 'bg-laser-purple/15 border border-laser-purple/30';
                    if (status === 'FAILED') return 'bg-red-500/15 border border-red-500/30';
                    return 'bg-dark-light border border-gray-700';
                };

                const getStatusIndicatorClass = (status) => {
                    if (status === 'SUCCEED') return 'w-3 h-3 bg-gradient-to-r from-emerald-400 to-green-500 rounded-full shadow-lg shadow-emerald-400/50';
                    if (status === 'RUNNING') return 'w-3 h-3 bg-gradient-to-r from-amber-400 to-yellow-500 rounded-full shadow-lg shadow-amber-400/50 animate-pulse';
                    if (status === 'FAILED') return 'w-3 h-3 bg-gradient-to-r from-red-400 to-pink-500 rounded-full shadow-lg shadow-red-400/50';
                    return 'w-3 h-3 bg-gradient-to-r from-gray-400 to-gray-500 rounded-full shadow-lg shadow-gray-400/50';
                };

                const getTaskTypeBtnClass = (taskType) => {
                    if (selectedTaskId.value === taskType) {
                        return 'text-laser-purple border-b-2 border-laser-purple';
                    }
                    return 'text-gray-400 hover:text-laser-purple';
                };

                const getModelBtnClass = (model) => {
                    if (taskForm.value.model_cls === model) {
                        return 'bg-laser-purple/20 border border-laser-purple/40 active shadow-laser animate-electric-pulse';
                    }
                    return 'bg-dark-light border border-gray-700 hover:bg-laser-purple/15 hover:border-laser-purple/40 transition-all hover:shadow-laser';
                };

                const getTaskTypeIcon = (taskType) => {
                    const iconMap = {
                        't2v': 'fas fa-font',
                        'i2v': 'fas fa-image',
                        'digital_human': 'fas fa-user'
                    };
                    return iconMap[taskType] || 'fas fa-video';
                };

                const getTaskTypeName = (taskType) => {
                    const nameMap = {
                        't2v': '文生视频',
                        'i2v': '图生视频',
                        'digital_human': '数字人'
                    };
                    return nameMap[taskType] || taskType;
                };

                const getPromptPlaceholder = () => {
                    if (selectedTaskId.value === 't2v') {
                        return '请输入视频生成提示词，描述视频内容、风格、场景等...';
                    } else if (selectedTaskId.value === 'i2v') {
                        return '请输入视频生成提示词，描述基于图片的视频内容、动作要求等...';
                    } else if (selectedTaskId.value === 'digital_human') {
                        return '请输入视频生成提示词，描述数字人形象、背景风格、动作要求等...';
                    }
                    return '请输入视频生成提示词...';
                };

                const getStatusTextClass = (status) => {
                    if (status === 'SUCCEED') return 'text-emerald-400';
                    if (status === 'RUNNING') return 'text-amber-400';
                    if (status === 'FAILED') return 'text-red-400';
                    return 'text-gray-400';
                };

                const getVideoThumbnail = (videoPath) => {
                    // 这里可以根据视频路径生成缩略图
                    // 暂时返回一个占位符
                    return 'https://via.placeholder.com/64x48/9a72ff/ffffff?text=Video';
                };

                const getImagePreview = (base64Data) => {
                    if (!base64Data) return '';
                    return `data:image/jpeg;base64,${base64Data}`;
                };

                const getVideoUrl = (taskId, name) => {
                    return `./api/v1/task/result?task_id=${taskId}&name=${name}`;
                };

                const initModelAndTasks = async () => {
                    await loadModels();
                    await refreshTasks();
                };

                // 任务状态管理
                const getTaskStatusDisplay = (status) => {
                    const statusMap = {
                        'CREATED': '已创建',
                        'PENDING': '等待中',
                        'RUNNING': '进行中',
                        'SUCCEED': '已完成',
                        'FAILED': '失败',
                        'CANCEL': '已取消'
                    };
                    return statusMap[status] || status;
                };

                const getTaskStatusColor = (status) => {
                    const colorMap = {
                        'CREATED': 'text-blue-400',
                        'PENDING': 'text-yellow-400',
                        'RUNNING': 'text-amber-400',
                        'SUCCEED': 'text-emerald-400',
                        'FAILED': 'text-red-400',
                        'CANCEL': 'text-gray-400'
                    };
                    return colorMap[status] || 'text-gray-400';
                };

                const getTaskStatusIcon = (status) => {
                    const iconMap = {
                        'CREATED': 'fas fa-clock',
                        'PENDING': 'fas fa-hourglass-half',
                        'RUNNING': 'fas fa-spinner fa-spin',
                        'SUCCEED': 'fas fa-check-circle',
                        'FAILED': 'fas fa-exclamation-triangle',
                        'CANCEL': 'fas fa-ban'
                    };
                    return iconMap[status] || 'fas fa-question-circle';
                };

                // 任务进度管理
                const getTaskProgress = (task) => {
                    if (task.status === 'SUCCEED') return 100;
                    if (task.status === 'FAILED' || task.status === 'CANCEL') return 0;
                    if (task.status === 'RUNNING') return 50;
                    if (task.status === 'PENDING') return 25;
                    return 0;
                };

                // 任务时间格式化
                const getTaskDuration = (startTime, endTime) => {
                    if (!startTime || !endTime) return '未知';
                    const start = new Date(startTime * 1000);
                    const end = new Date(endTime * 1000);
                    const diff = end - start;
                    const minutes = Math.floor(diff / 60000);
                    const seconds = Math.floor((diff % 60000) / 1000);
                    return `${minutes}分${seconds}秒`;
                };

                // 任务标签管理
                const getTaskTags = (task) => {
                    const tags = [];
                    if (task.task_type) tags.push(task.task_type);
                    if (task.model_cls) tags.push(task.model_cls);
                    if (task.params && task.params.prompt) {
                        const prompt = task.params.prompt;
                        if (prompt.includes('动画')) tags.push('动画');
                        if (prompt.includes('数字人')) tags.push('数字人');
                        if (prompt.includes('产品')) tags.push('产品');
                        if (prompt.includes('宣传')) tags.push('宣传');
                    }
                    return tags;
                };

                // 任务分享功能
                const shareTask = (task) => {
                    if (navigator.share) {
                        navigator.share({
                            title: `AI视频生成任务: ${task.params.prompt || '无标题'}`,
                            text: `使用${task.model_cls}模型生成的${getTaskTypeName(task.task_type)}`,
                            url: window.location.href
                        });
                    } else {
                        // 复制链接到剪贴板
                        const url = window.location.href;
                        navigator.clipboard.writeText(url).then(() => {
                            showAlert('任务链接已复制到剪贴板', 'success');
                        });
                    }
                };

                // 任务导出功能
                const exportTaskInfo = (task) => {
                    const taskInfo = {
                        task_id: task.task_id,
                        task_type: task.task_type,
                        model_cls: task.model_cls,
                        prompt: task.params.prompt,
                        status: task.status,
                        create_time: formatTime(task.create_t),
                        outputs: task.outputs
                    };
                    
                    const blob = new Blob([JSON.stringify(taskInfo, null, 2)], { type: 'application/json' });
                    const url = window.URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `task_${task.task_id}.json`;
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    window.URL.revokeObjectURL(url);
                };

                // 视频统计相关方法
                const getVideoDuration = (videoPath) => {
                    // 这里可以根据实际视频文件获取时长
                    // 暂时返回默认值
                    return '02:00';
                };

                const getVideoResolution = (videoPath) => {
                    // 这里可以根据实际视频文件获取分辨率
                    // 暂时返回默认值
                    return '720p';
                };

                const getVideoFileSize = (videoPath) => {
                    // 这里可以根据实际视频文件获取文件大小
                    // 暂时返回默认值
                    return '15.2MB';
                };

                // 任务历史记录管理
                const getTaskHistory = () => {
                    return tasks.value.filter(task => 
                        ['SUCCEED', 'FAILED', 'CANCEL'].includes(task.status)
                    );
                };

                const getActiveTasks = () => {
                    return tasks.value.filter(task => 
                        ['CREATED', 'PENDING', 'RUNNING'].includes(task.status)
                    );
                };

                // 任务搜索和过滤增强
                const searchTasks = (query) => {
                    if (!query) return tasks.value;
                    return tasks.value.filter(task => {
                        const searchText = [
                            task.task_id,
                            task.task_type,
                            task.model_cls,
                            task.params?.prompt || '',
                            getTaskStatusDisplay(task.status)
                        ].join(' ').toLowerCase();
                        return searchText.includes(query.toLowerCase());
                    });
                };

                const filterTasksByStatus = (status) => {
                    if (status === 'ALL') return tasks.value;
                    return tasks.value.filter(task => task.status === status);
                };

                const filterTasksByType = (type) => {
                    if (!type) return tasks.value;
                    return tasks.value.filter(task => task.task_type === type);
                };

                // 提示消息样式管理
                const getAlertClass = (type) => {
                    const classMap = {
                        'success': 'animate-slide-down',
                        'warning': 'animate-slide-down',
                        'danger': 'animate-slide-down',
                        'info': 'animate-slide-down'
                    };
                    return classMap[type] || 'animate-slide-down';
                };

                const getAlertBorderClass = (type) => {
                    const borderMap = {
                        'success': 'border-green-500 bg-green-50',
                        'warning': 'border-yellow-500 bg-yellow-50',
                        'danger': 'border-red-500 bg-red-50',
                        'info': 'border-blue-500 bg-blue-50'
                    };
                    return borderMap[type] || 'border-gray-500 bg-gray-50';
                };

                const getAlertTextClass = (type) => {
                    const textMap = {
                        'success': 'text-green-800',
                        'warning': 'text-yellow-800',
                        'danger': 'text-red-800',
                        'info': 'text-blue-800'
                    };
                    return textMap[type] || 'text-gray-800';
                };

                const getAlertIcon = (type) => {
                    const iconMap = {
                        'success': 'fas fa-check-circle text-green-500',
                        'warning': 'fas fa-exclamation-triangle text-yellow-500',
                        'danger': 'fas fa-times-circle text-red-500',
                        'info': 'fas fa-info-circle text-blue-500'
                    };
                    return iconMap[type] || 'fas fa-info-circle text-gray-500';
                };

                // 监听器
                watch(() => taskForm.value.task, () => {
                    taskForm.value.model_cls = '';
                    taskForm.value.stage = '';
                    
                    const availableModels = models.value.filter(m => m.task === taskForm.value.task);
                    if (availableModels.length > 0) {
                        const firstModel = availableModels[0];
                        taskForm.value.model_cls = firstModel.model_cls;
                        taskForm.value.stage = firstModel.stage;
                    }
                    
                    imagePreview.value = null;
                    taskForm.value.imageFile = null;
                });

                watch(() => taskForm.value.model_cls, () => {
                    taskForm.value.stage = '';
                    
                    const availableStages = models.value
                        .filter(m => m.task === taskForm.value.task && m.model_cls === taskForm.value.model_cls)
                        .map(m => m.stage);
                    if (availableStages.length > 0) {
                        taskForm.value.stage = availableStages[0];
                    }
                });

                // 生命周期
                onMounted(() => {
                    console.log('页面加载完成，显示测试数据');
                    console.log('当前用户:', currentUser.value);
                    console.log('可用模型:', models.value);
                    console.log('任务列表:', tasks.value);
                    
                    // 加载提示词历史记录
                    loadPromptHistory();
                });

                // 提示词模板管理
                const promptTemplates = {
                    't2v': [
                        {
                            id: 't2v_1',
                            title: '自然风景',
                            prompt: '一个宁静的山谷，阳光透过云层洒在绿色的草地上，远处有雪山，近处有清澈的溪流，画面温暖自然，充满生机。'
                        },
                        {
                            id: 't2v_2',
                            title: '城市夜景',
                            prompt: '繁华的城市夜景，霓虹灯闪烁，高楼大厦林立，车流如织，天空中有星星点缀，营造出都市的繁华氛围。'
                        },
                        {
                            id: 't2v_3',
                            title: '科技未来',
                            prompt: '未来科技城市，飞行汽车穿梭，全息投影随处可见，建筑具有流线型设计，充满科技感和未来感。'
                        }
                    ],
                    'i2v': [
                        {
                            id: 'i2v_1',
                            title: '人物动作',
                            prompt: '基于参考图片，让角色做出自然的行走动作，保持原有的服装和风格，背景可以适当变化。'
                        },
                        {
                            id: 'i2v_2',
                            title: '场景转换',
                            prompt: '保持参考图片中的人物形象，将背景转换为不同的季节或环境，如从室内到户外，从白天到夜晚。'
                        }
                    ],
                    'digital_human': [
                        {
                            id: 'dh_1',
                            title: '商务演讲',
                            prompt: '数字人进行商务演讲，表情自然，手势得体，背景为现代化的会议室，整体风格专业商务。'
                        },
                        {
                            id: 'dh_2',
                            title: '产品介绍',
                            prompt: '数字人介绍产品特点，语气亲切，动作自然，背景为产品展示区，突出产品的科技感和实用性。'
                        }
                    ]
                };

                const getPromptTemplates = (taskType) => {
                    return promptTemplates[taskType] || [];
                };

                const showPromptTemplates = () => {
                    if (!selectedTaskId.value) {
                        showAlert('请先选择任务类型', 'warning');
                        return;
                    }
                    showTemplates.value = !showTemplates.value;
                };

                const showPromptHistory = () => {
                    showHistory.value = !showHistory.value;
                };

                const selectPromptTemplate = (template) => {
                    taskForm.value.prompt = template.prompt;
                    showTemplates.value = false;
                    showAlert(`已应用模板: ${template.title}`, 'success');
                };

                // 提示词历史记录管理
                const promptHistory = ref([]);

                const getPromptHistory = () => {
                    return promptHistory.value.slice(-10); // 只显示最近10条
                };

                const addPromptToHistory = (prompt) => {
                    if (!prompt || prompt.trim().length === 0) return;
                    
                    // 避免重复添加
                    const trimmedPrompt = prompt.trim();
                    if (promptHistory.value.includes(trimmedPrompt)) {
                        // 将已存在的提示词移到最前面
                        promptHistory.value = promptHistory.value.filter(p => p !== trimmedPrompt);
                    }
                    
                    promptHistory.value.push(trimmedPrompt);
                    
                    // 限制历史记录数量
                    if (promptHistory.value.length > 50) {
                        promptHistory.value = promptHistory.value.slice(-50);
                    }
                    
                    // 保存到本地存储
                    localStorage.setItem('promptHistory', JSON.stringify(promptHistory.value));
                };

                const selectPromptHistory = (prompt) => {
                    taskForm.value.prompt = prompt;
                    showHistory.value = false;
                    showAlert('已应用历史提示词', 'success');
                };

                const clearPromptHistory = () => {
                    promptHistory.value = [];
                    localStorage.removeItem('promptHistory');
                    showAlert('提示词历史已清空', 'info');
                };

                // 加载提示词历史记录
                const loadPromptHistory = () => {
                    try {
                        const saved = localStorage.getItem('promptHistory');
                        if (saved) {
                            promptHistory.value = JSON.parse(saved);
                        }
                    } catch (error) {
                        console.warn('加载提示词历史记录失败:', error);
                    }
                };

                return {
                    isLoggedIn,
                    loading,
                    submitting,
                    showCreator,
                    searchQuery,
                    currentUser,
                    models,
                    tasks,
                    alert,
                    taskForm,
                    imagePreview,
                    audioPreview,
                    availableTaskTypes,
                    availableModelClasses,
                    filteredTasks,
                    selectedTaskId,
                    selectedTask,
                    statusFilter,
                    pagination,
                    currentPage,
                    pageSize,
                    showAlert,
                    setLoading,
                    apiCall,
                    logout,
                    loadModels,
                    handleImageUpload,
                    selectTask,
                    selectModel,
                    triggerImageUpload,
                    triggerAudioUpload,
                    removeImage,
                    removeAudio,
                    handleAudioUpload,
                    submitTask,
                    fileToBase64,
                    formatTime,
                    refreshTasks,
                    getStatusBadgeClass,
                    downloadSingleResult,
                    viewSingleResult,
                    cancelTask,
                    resumeTask,
                    viewTaskDetail,
                    showTaskCreator,
                    toggleSidebar,
                    clearPrompt,
                    getTaskItemClass,
                    getStatusIndicatorClass,
                    getTaskTypeBtnClass,
                    getModelBtnClass,
                    getTaskTypeIcon,
                    getTaskTypeName,
                    getPromptPlaceholder,
                    getStatusTextClass,
                    getVideoThumbnail,
                    getImagePreview,
                    getVideoUrl,
                    getTaskStatusDisplay,
                    getTaskStatusColor,
                    getTaskStatusIcon,
                    getTaskProgress,
                    getTaskDuration,
                    getTaskTags,
                    shareTask,
                    exportTaskInfo,
                    getVideoDuration,
                    getVideoResolution,
                    getVideoFileSize,
                    getTaskHistory,
                    getActiveTasks,
                    searchTasks,
                    filterTasksByStatus,
                    filterTasksByType,
                    getAlertClass,
                    getAlertBorderClass,
                    getAlertTextClass,
                    getAlertIcon,
                    getPromptTemplates,
                    showPromptTemplates,
                    showPromptHistory,
                    selectPromptTemplate,
                    promptHistory,
                    getPromptHistory,
                    addPromptToHistory,
                    selectPromptHistory,
                    clearPromptHistory,
                    loadPromptHistory
                };
            }
        }).mount('#app');
    </script>
</body>
</html>